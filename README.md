# Google Vertex AI Agent with MCP Security Tools

Deploy security-focused AI agents to Google Cloud with integrated access to Chronicle, SOAR, Threat Intelligence, and Security Command Center through the Model Context Protocol (MCP).

## Quick Start

See also: https://github.com/dandye/agentic_soc_agentspace/blob/main/docs/quick-start.md

```bash
# Clone and setup
git clone --recurse-submodules https://github.com/your-org/agentic_soc_agentspace.git
cd agentic_soc_agentspace

# Configure environment
cp .env.example .env
# Edit .env with your Google Cloud credentials

# Deploy agent
make agent-engine-deploy
```

For detailed deployment instructions, see the [Deployment Guide](DEPLOYMENT_GUIDE.md).

## Overview

This project enables you to:
- Deploy AI agents to Google Vertex AI Agent Engine with security tool access
- Integrate with Google Security Operations (Chronicle) for threat detection
- Connect to SOAR platforms for automated response workflows
- Access Google Threat Intelligence for IOC analysis
- Monitor cloud security posture via Security Command Center

## Architecture

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────────┐
│   main.py       │───▶│  Vertex AI       │───▶│   MCP Security      │
│   Agent Creator │    │  Agent Engine    │    │   Tools (stdio)     │
└─────────────────┘    └──────────────────┘    └─────────────────────┘
                               │                        │
┌─────────────────┐            │                ┌───────▼───────┐
│test_agent_engine│◀───────────┘                │ • Chronicle   │
│    Testing      │                             │ • SOAR        │
└─────────────────┘                             │ • GTI         │
                                                │ • SCC         │
                                                └───────────────┘
```

## Features

### Integrated Security Tools
- **Chronicle SecOps**: Real-time threat detection and investigation
- **SOAR Integration**: Automated incident response workflows
- **Threat Intelligence**: IOC enrichment and threat analysis
- **Security Command Center**: Cloud security posture management

### Agent Capabilities
- Natural language security analysis
- Automated alert triage and investigation
- Threat hunting and IOC analysis
- Incident response coordination
- Security posture assessment

## Prerequisites

- **Google Cloud Project** with billing enabled
- **Python 3.10+** installed locally
- **Google Cloud SDK** configured
- **Required APIs**:
  - Vertex AI API
  - Cloud Storage API
  - Cloud Build API

See [Deployment Guide](DEPLOYMENT_GUIDE.md#prerequisites) for detailed setup instructions.

## Installation

### 1. Clone Repository
```bash
git clone --recurse-submodules https://github.com/dandye/agentic_soc_agentspace.git
cd agentic_soc_agentspace
```

### 2. Configure Environment
```bash
cp .env.example .env
# Edit .env with your configuration
# NOTE: Some vars, like `REASONING_ENGINE`, are generated by make targets (i.e. `make agent-engine-deploy`)
#  so they are not available to you yet.
```

### 3. Install Dependencies
```bash
pip install -r requirements.txt
```

### 4. Deploy Agent
```bash
make agent-engine-deploy
# Or directly: python main.py
```

### 5. Update .env with vars emitted by previous step

1. Set REASONING_ENGINE in .env
2. Set AGENT_ENGINE_RESOURCE_NAME
  * ToDo: this is constructed from other env vars, so should be removed from .env


See [Deployment Guide](DEPLOYMENT_GUIDE.md) for complete instructions.

### 6. Create Agentspace App

Use the Google Cloud Console to create the App. Add the App ID to the .env file

### 7. Associate Agent Engine with Agentspace App

`make agentspace-register`


## Configuration

There are quite a few configuration items, so here is a recap.

### Required Environment Variables

For LOCATION, Determine which Region Agent Engine is using on this page:
https://console.cloud.google.com/vertex-ai/agents/agent-engines

`gcloud projects list` in the Cloud Shell Terminal in Google Cloud Console can help you to find thes other values.

```bash
# Google Cloud Configuration
PROJECT_ID=your-project-id
LOCATION=us-central1
STAGING_BUCKET=your-staging-bucket
PROJECT_NUMBER=123456789

# SOAR Integration (if using)
SOAR_URL=https://your-instance.siemplify-soar.com:443
SOAR_APP_KEY=your-api-key
```

#### Google SecOps env vars

`CHRONICLE_CUSTOMER_ID` and `CHRONICLE_PROJECT_ID` are on this page:
https://YOURS.backstory.chronicle.security/settings/profile

For `CHRONICLE_REGION`, see the Chronicle Region Codes as described on:
https://github.com/google/secops-wrapper/blob/main/regions.md


See [.env.example](.env.example) for all configuration options.

## Usage

### Deploy New Agent
```bash
# Full deployment with all tools
make agent-engine-deploy


### Test Deployed Agent
```bash
# Set REASONING_ENGINE in .env
REASONING_ENGINE=ENGINE_ID
AGENT_ENGINE_RESOURCE_NAME=projects/PROJECT_ID/locations/LOCATION/reasoningEngines/ENGINE_ID

ToDo: since this is constructed from other env vars, it would be good to remove it from the .env

# Run test interface
python test_agent_engine.py
```

### Example Queries
```python
"List soar cases"
"What are the recent security alerts?"
"Analyze IOCs for domain malicious.com"
"Show Security Command Center findings"
"Investigate user account compromise indicators"
"Find a runbook titled Malware IRP"
```

## Project Structure

```
├── main.py                    # Agent creation and deployment
├── test_agent_engine.py       # Testing interface
├── DEPLOYMENT_GUIDE.md        # Detailed deployment instructions
├── requirements.txt           # Python dependencies
├── Makefile                   # Automation workflows
├── .env.example               # Environment template
├── installation_scripts/
│   ├── install.sh             # Cloud deployment setup (installs `uv`)
│   ├── manage_agent_engine.py # Agent management utilities
│   ├── manage_agentspace.py   # Agentspace configuration
│   └── manage_oauth.py        # OAuth setup utilities
└── mcp-security/              # MCP security servers (submodule)
    └── servers/
        ├── mcp-server-soar/
        ├── mcp-server-secops/
        ├── mcp-server-gti/
        └── mcp-server-scc/
```

## Development

### Customizing the Agent

Edit `main.py` to customize:

```python
# Change model
model = "gemini-2.5-flash"  # or gemini-2.5-pro

# Modify system prompt
instruction = "Your custom security analyst instructions..."

# Select specific tools
tools = [secops_tool, soar_tool]  # Choose tools as needed
```

### Adding New MCP Tools

1. Add tool configuration to `MCPToolset` in `main.py`
2. Update `extra_packages` with server path
3. Modify installation script if needed

### Local Testing

```bash
# Test MCP servers locally
cd mcp-security/servers/secops-soar/secops_soar_mcp
uv run server.py
```
Success looks like:
```
2025-09-15 16:39:39,549 - INFO - __main__ - main - Starting SecOps SOAR MCP server
2025-09-15 16:39:39,817 - INFO - __main__ - get_enabled_integrations_set - No --integrations flag provided. No integrations are enabled.
2025-09-15 16:39:39,818 - INFO - __main__ - register_tools - Starting dynamic tool registration...
2025-09-15 16:39:39,824 - INFO - __main__ - register_tools - Finished scanning marketplace directory.
```
(and then hanging as it is waiting for input)

#### Validate configuration
```
python -c "from dotenv import load_dotenv; import os; load_dotenv(); print(os.getenv('PROJECT_ID'))"
```

## Troubleshooting

Common issues and solutions are documented in the [Deployment Guide](DEPLOYMENT_GUIDE.md#troubleshooting).

### Quick Fixes

**Authentication Issues**
```bash
gcloud auth application-default login
gcloud config set project $PROJECT_ID
gcloud auth application-default set-quota-project $PROJECT_ID
```

**Missing APIs**
```bash
gcloud services enable aiplatform.googleapis.com storage.googleapis.com
```

**MCP Tools Not Working**
```bash
git submodule update --init --recursive
```

## Documentation

- [Deployment Workflow](docs/DEPLOYMENT_WORKFLOW.md)
- [Env Vars walkthrought](docs/ENVIRONMENT_VARIABLES_FLOW.md) - Which env vars are defined when
- [Deployment Guide](DEPLOYMENT_GUIDE.md) - Complete deployment instructions
- [PRD on Env Vars](PRD_ENV_VARS.md) - Product requirements and specifications for env vars
- [PRD on Makefile](PRD_MAKE_TARGETS.md) - Product requirements and specifications for Makefile targets
- [MCP Security Docs](mcp-security/README.md) - Security tool documentation

## Support

- [GitHub Issues](https://github.com/dandye/agentic_soc_agentspace/issues) - Report bugs or request features
- [Vertex AI Docs](https://cloud.google.com/vertex-ai/docs) - Google Cloud documentation
- [MCP Protocol](https://modelcontextprotocol.io/) - Model Context Protocol specification

