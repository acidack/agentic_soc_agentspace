# Environment Variables Flow Visualization

## Complete Deployment Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           INITIAL SETUP                                 │
│                         Copy .env.example → .env                        │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────-────────┐
│                      STAGE 1: PREREQUISITES                              │
│                    (Set before any deployment)                           │
├──────────────────────────────────────────────────────────────-───────────┤
│  Required Core Variables:                                                │
│  ├── PROJECT_ID ..................... "your-project-id"                  │
│  ├── PROJECT_NUMBER ................. "123456789012"                     │
│  ├── LOCATION ....................... "us-central1"                      │
│  ├── STAGING_BUCKET ................. "your-staging-bucket"              │
│  └── GOOGLE_API_KEY ................. "AIab..."                          │
│                                                                          │
│  Optional Security Tools:                                                │
│  ├── CHRONICLE_CUSTOMER_ID .......... "a13f6726-efed..."                 │
│  ├── CHRONICLE_PROJECT_ID ........... "your-chronicle-project"           │
│  ├── CHRONICLE_REGION ............... "us"                               │
│  ├── SECOPS_SA_PATH ................. "/path/to/service-account.json"    │
│  ├── SOAR_URL ....................... "https://YOURS.siemplify-soar.com" │
│  ├── SOAR_APP_KEY ................... "012345ab-cdef..."                 |
│  └── VT_APIKEY ...................... "fedcba123456...."                 │
│                                                                          │
│  Optional Pre-configuration:                                             │
│  ├── AGENTSPACE_APP_ID .............. "app_01233456abcde"                │
│  ├── AGENTSPACE_DATA_STORE_ID ....... "datastore_fedcba0123456"          │
│  └── DATASTORE_PATH ................. "projects/.../dataStores/..."      │
└────────────────────────────────────────────────────────────────-─────────┘
                                    │
                                    ▼
                        ┌──────────────────────┐
                        │    make deploy       │
                        │  (validates prereqs) │
                        └──────────────────────┘
                                    │
                                    ▼
┌──────────────────────────────────────────────────────────────────────-───┐
│                    STAGE 2: DEPLOYMENT OUTPUTS                           │
│                     (Generated by deployment)                            │
├─────────────────────────────────────────────────────────────────────-────┤
│  DEPLOYMENT CREATES:                                                     │
│  ├── REASONING_ENGINE ............... "1234567890987654321"              │
│  │     └─ Save from deployment output                                    │
│  └── AGENT_ENGINE_RESOURCE_NAME ..... "projects/123456789012/            │
│        │                                locations/us-central1/           │
│        │                                reasoningEngines/9876543210..."  │
│        └─ Save from deployment output                                    │
│                                                                          │
│  Terminal Output:                                                        │
│  ┌───────────────────────────────────────────────────────────────┐       │
│  │ Agent deployed: projects/123456789012/locations/us-central1/  │       │
│  │                 reasoningEngines/1234567890987654321          │       │
│  │ ===============================================               │       │
│  │ DEPLOYMENT COMPLETE - Save these values to .env:              │       │
│  │ ===============================================               │       │
│  │   REASONING_ENGINE=1234567890987654321                        │       │
│  │   AGENT_ENGINE_RESOURCE_NAME=projects/123456789012/...        │       │
│  └───────────────────────────────────────────────────────────────┘       │
└──────────────────────────────────────────────────────────────────────-───┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌────────────────────┐           ┌────────────────────┐
        │  Standard Path     │           │   OAuth Path       │
        │  (No OAuth)        │           │  (With OAuth)      │
        └────────────────────┘           └────────────────────┘
                    │                               │
                    ▼                               ▼
    ┌───────────────────────────┐      ┌──────────────────────┐
    │ make manage-agentspace-   │      │ make oauth-create-   │
    │      register             │      │      auth            │
    └───────────────────────────┘      └──────────────────────┘
                    │                               │
                    │                               ▼
                    │                   ┌─────────────────────────────┐
                    │                   │ OAuth Authorization Created │
                    │                   ├─────────────────────────────┤
                    │                   │ OAUTH_AUTH_ID:              │
                    │                   │   └── "my-oauth-auth"       │
                    │                   └─────────────────────────────┘
                    │                               │
                    │                               ▼
                    │                   ┌──────────────────────┐
                    │                   │ make manage-         │
                    │                   │   agentspace-        │
                    │                   │   link-agent         │
                    │                   └──────────────────────┘
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    STAGE 3: INTEGRATION OUTPUTS                         │
│                    (Generated by integration)                           │
├─────────────────────────────────────────────────────────────────────────┤
│  AGENTSPACE REGISTRATION CREATES:                                       │
│  └── AGENTSPACE_AGENT_ID ............ "1234567890987654321"             │
│        └─ Save from registration output                                 │
│                                                                         │
│  Terminal Output:                                                       │
│  ┌───────────────────────────────────────────────────────────────┐      │
│  │ Successfully registered agent to AgentSpace!                  │      │
│  │ Agent name: projects/.../agents/1234567890987654321           │      │
│  │ ===============================================               │      │
│  │ REGISTRATION COMPLETE - Save this value to .env:              │      │
│  │ ===============================================               │      │
│  │   AGENTSPACE_AGENT_ID=1234567890987654321                     │      │
│  └───────────────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                        ┌──────────────────────┐
                        │  DEPLOYMENT COMPLETE │
                        │  All variables set   │
                        └──────────────────────┘
```

## Environment Variables by Stage

### Stage 1: Prerequisites (User Provided)
```
PROJECT_ID                  ──┐
PROJECT_NUMBER              ──┤
LOCATION                    ──┤── Core Requirements
STAGING_BUCKET              ──┤
GOOGLE_API_KEY              ──┘

CHRONICLE_CUSTOMER_ID       ──┐
CHRONICLE_PROJECT_ID        ──┤
CHRONICLE_REGION            ──┤── Security Tools
SECOPS_SA_PATH              ──┤   (Optional)
SOAR_URL                    ──┤
SOAR_APP_KEY                ──┤
VT_APIKEY                   ──┘

OAUTH_CLIENT_ID             ──┐
OAUTH_CLIENT_SECRET         ──┤── OAuth Config
OAUTH_AUTH_URI              ──┤   (Optional)
OAUTH_TOKEN_URI             ──┘

AGENTSPACE_APP_ID           ──┐
AGENTSPACE_DATA_STORE_ID    ──┤── Pre-existing Resources
DATASTORE_PATH              ──┘   (Optional)
```

### Stage 2: Deployment Outputs (System Generated)
```
                    make deploy
                        │
                        ▼
REASONING_ENGINE ─────────────► "1234567890987654321"
AGENT_ENGINE_RESOURCE_NAME ───► "projects/.../reasoningEngines/..."
```

### Stage 3: Integration Outputs (System Generated)
```
                make oauth-create-auth
                        │
                        ▼
OAUTH_AUTH_ID ────────────────► "my-oauth-auth"

            make manage-agentspace-register
                        OR
            make manage-agentspace-link-agent
                        │
                        ▼
AGENTSPACE_AGENT_ID ──────────► "1234567890987654321"
```

## Decision Points

```
                    Deployment Complete
                           │
                           ▼
                ┌──────────────────┐
                │ Need OAuth?       │
                └──────────────────┘
                     /        \
                   NO          YES
                   /            \
                  ▼              ▼
        ┌─────────────┐    ┌──────────────┐
        │ Standard    │    │ OAuth Setup  │
        │ Registration│    │ + Link Agent │
        └─────────────┘    └──────────────┘
                  \              /
                   \            /
                    ▼          ▼
              ┌──────────────────┐
              │ AgentSpace Ready │
              └──────────────────┘
```

## Validation Checkpoints

```
┌─────────────┐     ┌─────────────┐     ┌──────────────┐
│   Stage 1   │────►│   Stage 2   │────►│   Stage 3    │
│   Prereqs   │     │   Deploy    │     │ Integration  │
└─────────────┘     └─────────────┘     └──────────────┘
       │                   │                    │
       ▼                   ▼                    ▼
check-prereqs        check-deploy        check-integration
  validates:          validates:           validates:
  - PROJECT_ID        - REASONING_         - AGENTSPACE_
  - PROJECT_NUMBER      ENGINE                APP_ID
  - LOCATION          - AGENT_ENGINE_       - (OAuth vars
  - STAGING_BUCKET      RESOURCE_NAME         if needed)
  - GOOGLE_API_KEY
```

## Quick Reference: Variable Sources

| Variable | Stage | Source | Required |
|----------|-------|--------|----------|
| PROJECT_ID | 1 | User provides | Yes |
| PROJECT_NUMBER | 1 | User provides | Yes |
| LOCATION | 1 | User provides | Yes |
| STAGING_BUCKET | 1 | User provides | Yes |
| GOOGLE_API_KEY | 1 | User provides | Yes |
| CHRONICLE_* | 1 | User provides | If using Chronicle |
| SOAR_* | 1 | User provides | If using SOAR |
| VT_APIKEY | 1 | User provides | If using GTI |
| REASONING_ENGINE | 2 | `make deploy` output | Yes |
| AGENT_ENGINE_RESOURCE_NAME | 2 | `make deploy` output | Yes |
| OAUTH_AUTH_ID | 3 | `make oauth-create-auth` output | If using OAuth |
| AGENTSPACE_AGENT_ID | 3 | `make manage-agentspace-register` output | If using AgentSpace |